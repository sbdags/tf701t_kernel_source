<html>
<head>
<title>Add many compositing layers on blank background with a canvas underneath the layers</title>
<style>
body {
    min-width: 800px;
    min-height: 600px;
    background-color: #f00;
}
canvas {
    position: absolute;
    left: 0;
    top: 0;
}
.layer {
    -webkit-transform: translateZ(0);
    width: 25px;
    height: 25px;
    position: absolute;
    background-color: #0f0;
    font-size: 50%;
}
</style>
<script>
if (window.layoutTestController) {
    layoutTestController.dumpAsText(true);
    layoutTestController.waitUntilDone();
}

var elementCount = 0;
var w = 25;
var resultCount = 600 / w * 600 / w;
var ctx;

function addOne() {
    var d = document.createElement('div');
    d.style.left = ((elementCount * w) % 600) + 'px';
    d.style.top = (Math.floor(elementCount * w / 600) * w % 600) + 'px';
    d.classList.add('layer');
    d.textContent = elementCount;
    document.body.appendChild(d);

    ++elementCount;
}

function addSixteen() {
    for (var i = 0; i < 16 && elementCount < resultCount; ++i) {
        addOne();
    }
    // The red part of the canvas should remain behind the green layers
    ctx.fillStyle = '#ff0000';
    ctx.fillRect(0, 0, 599, 600);
    // The green part of the canvas is not covered by the layers
    ctx.fillStyle = '#00ff00';
    ctx.fillRect(599, 0, 201, 600);
    if (elementCount < resultCount) {
        setTimeout(addSixteen, 20);
    } else if (window.layoutTestController) {
        setTimeout(function() {
            layoutTestController.notifyDone();
        }, 300);
    }
}

function init() {
    var canvas = document.createElement('canvas');
    canvas.width = 800;
    canvas.height = 600;
    ctx = canvas.getContext('2d');
    document.body.appendChild(canvas);
    addSixteen();
}
</script>
</head>

<body onload="init()">
</body>
</html>
