<html>
<head>
<title></title>
<script src="./touch-util.js"></script>
<script type='text/javascript'>
function doGC()
{
    if (window.GCController)
        return GCController.collect();

    if (window.gc)
        return window.gc();

    for (var i = 0; i < 10000; i++)
        var s = new String("");
}

function sendTouchUp()
{
    doGC();
    // This touchend will cause a crash if the bug is present.
    eventSender.releaseTouchPoint(0);
    eventSender.touchEnd();
    // This touchstart will finish the test when we don't crash.
    // FIXME: this setTimeout shouldn't be here, but on Android we don't work without it anymore.
    setTimeout(function() {
    eventSender.addTouchPoint(10,10);
    eventSender.touchStart();
    }, 16);
}

function finishTest(e)
{
    layoutTestController.notifyDone();
}

document.ontouchstart =  finishTest;
</script>
</head>
<body onload="runTouchTest(sendTouchUp);">
<p>If the test doesn't crash, then PASS</p>
</body>
</html>
